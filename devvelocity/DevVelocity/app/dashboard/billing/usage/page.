"use client";

import { useState, useEffect } from "react";
import BillingUsageChart from "@/components/BillingUsageChart";

interface UsageRecord {
  date: string;
  builds: number;
  compute_hours: number;
  ai_automation: number;
}

export default function UsagePage() {
  const [usage, setUsage] = useState<UsageRecord[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // TODO: Connect to your usage-sync worker or Supabase logs
    async function loadUsage() {
      setLoading(true);

      // Placeholder mock data — safe to replace with real logs later
      const mock = [
        { date: "2025-01-01", builds: 3, compute_hours: 2, ai_automation: 14 },
        { date: "2025-01-02", builds: 2, compute_hours: 1.2, ai_automation: 9 },
        { date: "2025-01-03", builds: 6, compute_hours: 4.5, ai_automation: 22 },
        { date: "2025-01-04", builds: 4, compute_hours: 3.1, ai_automation: 16 },
      ];

      setUsage(mock);
      setLoading(false);
    }

    loadUsage();
  }, []);

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-[60vh]">
        <p className="text-gray-400 text-lg">Loading usage data...</p>
      </div>
    );
  }

  return (
    <main className="max-w-5xl mx-auto px-6 py-16 text-white">
      <h1 className="text-3xl font-bold mb-6">Usage</h1>

      <p className="text-gray-300 mb-10">
        Track your multi-cloud builds, compute consumption, and AI automation usage.
        Metered billing and quota alerts will appear here once enabled.
      </p>

      <div className="bg-neutral-900 p-6 rounded-xl border border-neutral-800 mb-12">
        <h2 className="text-xl font-semibold mb-4">Usage Summary</h2>

        <ul className="text-gray-300 space-y-2">
          <li>• Total Builds: {usage.reduce((a, b) => a + b.builds, 0)}</li>
          <li>
            • Compute Hours:{" "}
            {usage.reduce((a, b) => a + b.compute_hours, 0).toFixed(1)}
          </li>
          <li>
            • AI Automation Tasks:{" "}
            {usage.reduce((a, b) => a + b.ai_automation, 0)}
          </li>
        </ul>
      </div>

      <div className="bg-neutral-900 p-6 rounded-xl border border-neutral-800">
        <h2 className="text-xl font-semibold mb-6">Usage Breakdown</h2>

        <BillingUsageChart data={usage} />
      </div>
    </main>
  );
}
